<!DOCTYPE html>
<html>
<head>
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-Z1S57DSZYT"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-Z1S57DSZYT');
  </script>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CuentosGPT</title>
  <link rel="icon" type="image/x-icon" href="favicon.ico">
  <link rel="stylesheet" href="css/styles.css">
  <link rel="stylesheet" href="css/stylesIpad.css">
  <link rel="stylesheet" href="css/stylesDesktop.css">
  <link rel="stylesheet" href="css/stylesIphone.css">
  <link rel="stylesheet" href="css/stylesLandscape.css">
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <script>
    function decodeJwtResponse(token) {
        var base64Url = token.split(".")[1];
        var base64 = base64Url.replace(/-/g, "+").replace(/_/g, "/");
        var jsonPayload = decodeURIComponent(
          atob(base64)
            .split("")
            .map(function (c) {
              return "%" + ("00" + c.charCodeAt(0).toString(16)).slice(-2);
            })
            .join("")
        );

        return JSON.parse(jsonPayload);
      }

    // Add an event listener to the log out button
    document.getElementById("logoutButton").addEventListener("click", function() {
      // Call the Google Accounts API to trigger the logout process
      google.accounts.id.disableAutoSelect();
      google.accounts.id.prompt((notification) => {
        if (notification.isNotDisplayed() || notification.isSkippedMoment()) {
          // User is already logged out, handle it accordingly
          console.log('User already logged out');
        }
      });
    });

    function handleCredentialResponse(response) {
      const responsePayload = decodeJwtResponse(response.credential);
      const custData = document.querySelector('#cust-data');
      const loginButton = document.querySelector('#login-button');
      
      loginButton.hidden = responsePayload.name
      loggedInData = responsePayload.name + ' - ' + responsePayload.sub
      custData.innerHTML = responsePayload.name ? loggedInData : 'Customer';

      const { sub: id, name, picture, email } = responsePayload;

      const cust = JSON.stringify({ id, name, picture, email });

      localStorage.setItem('cust', cust);
    }
  </script>
</head>
<body>
 
  <form referrerpolicy="no-referrer-when-downgrade">

    <h1 class="page-title" data-lang="contactUs">Login</h1>
    <div id="login-button">
      <div id="g_id_onload"
          data-client_id="483143053123-rm1tqjsiiqk0gao19ki46pgmip6u9se8.apps.googleusercontent.com"
          data-context="signin"
          data-ux_mode="popup"
          data-login_uri="http://localhost"
          data-auto_select="true"
          data-itp_support="true"
          data-callback="handleCredentialResponse">
          
      </div>

      <div class="g_id_signin"
          data-type="standard"
          data-shape="rectangular"
          data-theme="outline"
          data-text="continue_with"
          data-size="large"
          data-locale="es-419"
          data-logo_alignment="left">
      </div>
    </div>
    <div id="cust-data" data-lang="message">Customer</div>
    <button id="logoutButton">Log Out</button>
    
    

  </form>

  
  <div class="navbar" id="myNavbar">

    <div class="navbar-element navbar-element-left">
      <div class="dropdown">
        <div class="dropdown-toggle" onclick="toggleDropdown()">
          <img class="flag-selected-image" src="images/flags/es.png" alt="es" id="selected-language">
        </div>
        <div class="dropdown-content font-size-content" id="langSelector">
          <img class="flag-image flag-image-border" src="images/flags/es.png" alt="es" onclick="selectLanguage(this, 'es')">
          <img class="flag-image flag-image-border" src="images/flags/en.png" alt="en" onclick="selectLanguage(this, 'en')">
          <!-- <img class="flag-image flag-image-border" src="images/flags/fr.png" alt="fr" onclick="selectLanguage(this, 'fr')">
          <img class="flag-image flag-image-border" src="images/flags/pt.png" alt="pt" onclick="selectLanguage(this, 'pt')">
          <img class="flag-image flag-image-border" src="images/flags/de.png" alt="de" onclick="selectLanguage(this, 'de')"> -->
          <img class="flag-image flag-image-border"src="images/flags/it.png" alt="it" onclick="selectLanguage(this, 'it')">
        </div>
      </div>
    </div>

    <div class="navbar-element">
      <div class="dropdown">
        <div class="dropdown-toggle">
          <a href="home.html">
            <img class="flag-image pepe"src="images/menu/home.png" alt="home">
          </a>
        </div>
      </div>
    </div>

    <div class="navbar-element navbar-element-right">
      <div class="dropdown">
        <div class="dropdown-toggle">
          <a href="contact.html">
            <img class="flag-image"src="images/menu/contact.png" alt="info">
          </a>
        </div>
      </div>
    </div>

  </div>
  
  <script src="js/main.js"></script>
</body>
</html>